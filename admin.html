<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin – Trinetra Bhojanalaya</title>

    <link rel="stylesheet" href="assets/style.css">

    <script type="module">

        import { db } from "./assets/firebase.js";
        import { collection, query, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const orderBox = document.getElementById("orders");

        const q = query(collection(db, "orders"), orderBy("timestamp", "desc"));

        onSnapshot(q, snapshot => {
            orderBox.innerHTML = "";

            snapshot.forEach(doc => {
                let o = doc.data();

                let cartHTML = o.cart
                    .map(i => `${i.name} x${i.qty} — ₹${i.qty * i.price}`)
                    .join("<br>");

                orderBox.innerHTML += `
                    <div class="order-item">
                        <b>Name:</b> ${o.name}<br>
                        <b>Type:</b> ${o.type}<br>
                        <b>Address:</b> ${o.type === "delivery" ? o.address : "Takeaway"}<br><br>

                        <b>Items:</b><br>${cartHTML}<br><br>

                        <b>Subtotal:</b> ₹${o.subtotal}<br>
                        <b>Delivery Charge:</b> ₹${o.deliveryCharge}<br>
                        <b>Total:</b> ₹${o.total}<br><br>

                        <b>Time:</b> ${o.timestamp?.toDate()}<br>
                        <b>GPS:</b> ${o.gpsLat}, ${o.gpsLon}
                    </div>
                `;
            });
        });

    </script>
</head>

<body>

<header class="navbar">
    <div class="nav-left">
        <img src="images/logo.jpg" class="logo">
        <span class="brand">Admin Panel</span>
    </div>
</header>

<section style="padding:20px;">
    <h1>Orders</h1>
    <div id="orders"></div>
</section>

</body>
</html>
