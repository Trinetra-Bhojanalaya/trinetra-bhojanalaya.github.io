<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order – Trinetra Bhojanalaya</title>

    <link rel="stylesheet" href="assets/style.css">

    <!-- Load JS in correct order -->
    <script src="assets/cart.js"></script>
    <script src="assets/gps.js" defer></script>
    <script src="assets/delivery.js" defer></script>
    <script src="assets/saveOrder.js" defer></script>
</head>

<body>

<header class="navbar">
    <div class="nav-left">
        <img src="images/logo.jpg" class="logo">
        <span class="brand">Order Now</span>
    </div>
</header>

<section class="order-box">

    <h1>Your Order</h1>

    <!-- CART SUMMARY -->
    <div id="cartSummary" class="cart-summary"></div>

    <h1>Customer Details</h1>

    <label>Your Name</label>
    <input id="custName" type="text" placeholder="Enter your name">

    <label>Order Type</label>
    <select id="orderType" onchange="handleOrderType()">
        <option value="delivery">Delivery</option>
        <option value="takeaway">Takeaway</option>
    </select>

    <!-- DELIVERY ADDRESS -->
    <div id="addressBox">
        <label>Delivery Address</label>
        <textarea id="deliveryAddress" placeholder="Enter complete delivery address"></textarea>
    </div>

    <!-- GPS BUTTON -->
    <button id="gpsBtn" class="btn-secondary" onclick="getGPS()">Use My Current Location</button>
    <p id="gpsStatus" class="gps-status"></p>

    <p id="deliveryNote" class="delivery-note"></p>

    <button class="btn-primary" onclick="sendToWhatsApp()">Place Order</button>

</section>

<script>
/* ------------ RENDER CART ON PAGE LOAD ------------ */

const cart = getSavedCart(); // from cart.js
let box = document.getElementById("cartSummary");

if (!cart || cart.length === 0) {
    box.innerHTML = `<p>Your cart is empty.</p>`;
} else {
    let html = `<h2>Items:</h2><ul class="cart-list">`;

    cart.forEach(item => {
        html += `
            <li>
                ${item.name} × ${item.qty}  
                <span>₹${item.qty * item.price}</span>
            </li>
        `;
    });

    let total = cart.reduce((sum, x) => sum + x.price * x.qty, 0);

    html += `</ul><h3 class="cart-total">Total: ₹${total}</h3>`;

    box.innerHTML = html;
}

/* ------------ DELIVERY VS TAKEAWAY UI ------------ */

function handleOrderType() {
    const type = document.getElementById("orderType").value;
    const addressBox = document.getElementById("addressBox");
    const gpsBtn = document.getElementById("gpsBtn");
    const gpsStatus = document.getElementById("gpsStatus");
    const note = document.getElementById("deliveryNote");

    if (type === "takeaway") {
        addressBox.style.display = "none";
        gpsBtn.style.display = "none";
        gpsStatus.innerHTML = "";
        note.innerHTML = "";
    } else {
        addressBox.style.display = "block";
        gpsBtn.style.display = "block";
    }
}

handleOrderType(); // run once on page load

</script>

</body>
</html>
